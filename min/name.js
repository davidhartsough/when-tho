const getEl=t=>document.getElementById(t),hoursInput=getEl("hours"),daysInput=getEl("days"),nameInput=getEl("event-name");function isValidNumber(t,e=24){return!Number.isNaN(t)&&Number.isSafeInteger(t)&&t>=0&&t<e}function getNumsFromKebab(t,e=24){return t.split("-").map(Number).filter(n=>isValidNumber(n,e)).sort((n,o)=>n-o)}function redirectOut(){window.location.replace(`${window.location.origin}/cities/`)}const keyNums=["0","1","2","3","4","5","6"];function setHiddenInputs(){const{searchParams:t}=new URL(window.location.href),e=t.get("h");if(!e||e.length<1){redirectOut();return}const n=getNumsFromKebab(e,24),o=[];if(keyNums.forEach((a,i)=>{t.get(`d${a}`)==="1"&&o.push(i)}),o.length<1){redirectOut();return}daysInput.value=o.join("-"),hoursInput.value=n.join("-")}setHiddenInputs();function getTimestamps(t,e){const n=[],o=new Date;o.setDate(o.getDate()+1),o.setHours(0,0,1,0);const a=o.getDay();return t.forEach(i=>{const s=new Date(o);i>a?s.setDate(s.getDate()+i-a):i<a&&s.setDate(s.getDate()+(i+(7-a))%7),e.forEach(r=>{s.setHours(r),n.push(s.getTime())})}),n}const submitButton=getEl("submit-btn");function setLoading(){submitButton.disabled=!0,getEl("loader").className="show"}function getPoll(){const t=nameInput.value,e=getNumsFromKebab(daysInput.value,7),n=getNumsFromKebab(hoursInput.value,24),o=getTimestamps(e,n);return{name:t,timestamps:o}}async function addPoll(t){const e=await fetch("https://when-tho.web.app/api/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({poll:t})}),{id:n}=await e.json();return window.localStorage.setItem(`poll--${n}`,JSON.stringify(t)),n}async function savePoll(t){const e=await addPoll(t);window.location.href=`${window.location.origin}/vote/?event=${e}`}getEl("form").addEventListener("submit",t=>(t.preventDefault(),setLoading(),savePoll(getPoll()),!1));
